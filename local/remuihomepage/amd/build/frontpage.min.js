define(["jquery","core/modal_factory","core/templates","core/str","core/modal_events","local_remuihomepage/sectionmanager","core/fragment","core/ajax","core/notification","theme_remui/events"],function(e,t,o,i,n,s,a,r,c,l){var d=-1,u=null,g=null,m=".home-sections button.section-visibility",h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e};function f(e,t,o,i,n){r.call([{methodname:"local_remuihomepage_get_frontpage_categories",args:{instanceid:e,offset:t,limit:o}}])[0].done(i).fail(n)}function p(t,o){var i={dots:!1,arrows:!0,infinite:!1,speed:500,prevArrow:e("section[data-instance='"+t+"'] .button-container .btn-prev"),nextArrow:e("section[data-instance='"+t+"'] .button-container .btn-next"),rtl:"rtl"==e("html").attr("dir"),slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:800,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]};null!=o&&"object"==typeof o&&h(i,o);var n=s.getSectionElement(t);n.find(".available-courses").addClass("d-none"),0==n.find(".courses-slider .empty-courses-container").length&&(n.find(".courses-slider").slick(i).on("setPosition",function(t,o){e(n).find(".slick-slide > div").css("height","100%"),o.$slides.css("height",o.$slideTrack.height()+"px")}),n.find(".available-courses").removeClass("d-none"))}function v(e,t,i){s.showSectionLoader(e,!0);var n=s.getSectionElement(e);n.find(".courses-slider").removeClass("show"),r.call([{methodname:"local_remuihomepage_get_frontpage_section_courses_in_category",args:{instanceid:e,categoryid:t},done:function(t){(t=JSON.parse(t)).shadowless=t.sectionproperties.shadowless,t.shadowcolor=t.sectionproperties.shadowcolor,n.find(".courses-slider.slick-initialized.slick-slider").slick("unslick"),n.find(".courses-slider").empty(),n.data("totalcourses",t.totalcourse),n.data("current",0),o.render("local_remuihomepage/courses_cards",t).done(function(t,s){o.appendNodeContents(n.find(".courses-slider"),t,s),p(e,{slidesToShow:3,slidesToScroll:3}),"function"==typeof i&&i()}).fail(c.exception),s.showSectionLoader(e,!1)},fail:function(t){s.showSectionLoader(e,!1),c.exception(t)}}])}var _=function(t){var o=e(t).attr("id").replace("id_block_","").replace("_style",""),i="#id_block_"+o+"_htmleditable ",n=e(t).val().replace(/(([\.\#]?[\w\d\_\-]+\s*)+\{)/,function(e){return i+e});e(t).next().is("#block-"+o+"-style")||e(t).after('<style id="block-'+o+'-style" type="text/css"></style>'),e(t).next().html(n)};function y(t){return e(t).attr("data-instance")}var b=function(t,o){var i={instanceid:t};null!=o&&(i.formdata=o);var n=a.loadFragment("local_remuihomepage","frontpage_section_form",d,i);return n.done(function(t,o){setTimeout(function(){var t=e("body").find("form .block-style textarea");0!=t.length&&t.each(function(t,o){_(e(o))})},2e3)}),n},w=function(){!function(i){var n=e(".add-section");t.create({large:!0,body:o.render("local_remuihomepage/sections_list",i)},n).then(function(e){u=e,e.setTitle(M.util.get_string("addsection","local_remuihomepage")),e.modal.addClass("modal-sidebar d-inline-flex"),e.modal.width("500px")}.bind(this)).fail(c.exception)}({sections:[{section:"slider",title:M.util.get_string("slidersection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/slider","local_remuihomepage")},{section:"aboutus",title:M.util.get_string("aboutussection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/aboutus","local_remuihomepage")},{section:"contact",title:M.util.get_string("contactsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/contact","local_remuihomepage")},{section:"feature",title:M.util.get_string("featuresection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/feature","local_remuihomepage")},{section:"courses",title:M.util.get_string("coursessection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/courses","local_remuihomepage")},{section:"team",title:M.util.get_string("teamsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/team","local_remuihomepage")},{section:"testimonial",title:M.util.get_string("testimonialsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/testimonial","local_remuihomepage")},{section:"html",title:M.util.get_string("htmlsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/html","local_remuihomepage")},{section:"separator",title:M.util.get_string("separatorsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/separator","local_remuihomepage")}]})},S=function(){e(window).scroll(function(){if(e(".pagelayout-frontpage section.lazy-section").each(function(t){var o=e(this).position().top;if(e(window).scrollTop()+e(window).height()+2*e(window).height()>o&&e(this).is(".lazy-section")){e(this).removeClass("lazy-section");var i=e(this).data("instance"),n=s.getLoadedSection(i);s.reloadSection({success:!0,context:n},function(){e('.home-sections section[data-instance="'+i+'"]')})}else;}),e(".pagelayout-frontpage section.invisible").each(function(t){var o=e(this).position().top+100;e(window).scrollTop()+e(window).height()>o&&setTimeout(function(){e(this).removeClass("invisible"),1==appearanimation&&("animation-slide-left-right"==appearanimationstyle?e(this).prev().is(".animation-slide-left")?e(this).addClass("animation-slide-right"):e(this).addClass("animation-slide-left"):e(this).addClass(appearanimationstyle))}.bind(this),100)}),transparentheader){if(e("section[data-instance]:first-child").is(".section-slider"))if(e(window).scrollTop()<45)return void e("body.has-slider").addClass("animate-header");e("body.has-slider").removeClass("animate-header")}}),e("body").on("input",".separator-style select, .separator-style input",function(){!function(t){var o=e(t).find("#id_style").val(),i=e(t).find('[name="color"]').val(),n=e(t).find('[name="color2"]').val(),s=e(t).find("#id_height").val(),a={margin:"0px auto",width:e(t).find("#id_width").val()+"%"};switch(e(t).find('[name="color2"]').parents(".separator-style").toggleClass("d-none","gradient"!=o),o){case"blur":a.height="0px",a["background-image"]="none",a.border="1px solid "+i,a["box-shadow"]="0 0 "+s+"px "+s/2+"px "+i;break;case"blurend":a.background="none",a["box-shadow"]="none",a.border="none",a.height=s+"px",a["background-image"]="linear-gradient(to right, #ffffff, "+i+", #ffffff)";break;case"gradient":a["box-shadow"]="none",a["background-image"]="none",a.border="none",a.height=s+"px",a.background="linear-gradient(to right, "+i+" 0%, "+n+" 50%, "+i+" 100%)";break;default:a["box-shadow"]="none",a["background-image"]="none",a.height="0px",a["border-top"]=s+"px "+o+" "+i}e(t).find("#remui_separator_output").css(a)}(e(this).closest("form"))}),e("body").on("change",".updateform select",function(){var t=e(this).parents("form").find('[name="instanceid"]').val(),o=JSON.stringify(g.getRoot().find("form").serialize()),i=b(t,o);g.setBody(i)}),e(document).on("click",".home-sections button.edit-section",function(){var o=y(this),i=e(this).attr("data-sectionname");t.create({type:t.types.SAVE_CANCEL,title:"Edit "+i.charAt(0).toUpperCase()+i.slice(1)+" Section",body:b(o,null)}).then(function(t){g=t,t.modal.addClass("modal-sidebar d-inline-flex editmodal");var i=t.getRoot();i.on(n.save,function(e){e.preventDefault();var t=i.find("form");function n(){var e=JSON.stringify(t.serialize());s.updateSection(o,e),g.hide()}if("undefined"!=typeof remui_section_form_validate){if(response=remui_section_form_validate(t),"object"==typeof response)return void response.then(function(e){e&&n()});if(!response)return}n()}),i.on(n.hidden,function(){g.destroy(),e(document).find(".mform.atto_form.atto_media").parents(".moodle-dialogue-base").remove()}),t.show()})}),e(document).on("click",".home-sections button.delete-section",function(){var e=y(this);t.create({type:t.types.SAVE_CANCEL,title:"Delete item",body:"Do you really want to delete?"}).then(function(t){t.setSaveButtonText("Delete");var o=t.getRoot();o.on(n.save,function(){s.deleteInstance(e,!0)}),o.on(n.hidden,function(){t.destroy()}),t.show()})}),e(document).on("click",".home-sections button.cancel-delete-section",function(){var e=y(this);s.deleteInstance(e,!1)}),e(document).on("click",".home-sections button.confirm-delete-section",function(){var e=y(this);s.deleteInstance(e,2)}),e("body").on("input",".block-style textarea",function(){_(e(this))}),e(document).on("click",".settings",function(){t.create({type:t.types.SAVE_CANCEL,title:M.util.get_string("homepagesettings","local_remuihomepage"),body:a.loadFragment("local_remuihomepage","frontpage_settings_form",d)},e("#create")).done(function(e){e.modal.addClass("modal-sidebar d-inline-flex editmodal"),e.show(),e.getRoot().on(n.save,function(t){t.preventDefault();var o=e.getRoot().find("form"),i=JSON.stringify(o.serialize());r.call([{methodname:"local_remuihomepage_save_frontpage_settings",args:{settings:i}}])[0].done(function(e){window.location.reload()}).fail(c.exception),e.hide()}),e.getRoot().on(n.hidden,function(){e.destroy()})})}),e(document).on("click",".sections-container div[class*='section-']",function(){var t=e(this).data("section");u.hide(),s.setSectionName(t),s.addSection()}),e("body").on("click",".moveup-section",function(){s.reorderSection(e(this).data("instance"),-1,!0)}).on("click",".movedown-section",function(){s.reorderSection(e(this).data("instance"),1,!0)}),e("body").on("click",m,function(){var t=e(this).data("instance"),o=e(this).data("visible");s.updateVisibility(t,!o)}),e(document).on("slid.bs.carousel",".home-sections section .carousel",function(){var t=e(this).parent().data("instance");s.playSliderVideo(t)}),e(document).on("click",".editing-action",function(){var t=e('<form method="post"></form>');t.append("<input type='hidden' name='frontpageediting' value='1'/>"),t.append("<input type='hidden' name='editpage' value='"+e(this).data("edit")+"'/>"),e("body").append(t),t.submit()}),e(document).on("click",".publish",function(){var t=e('<form method="post"></form>');t.append("<input type='hidden' name='frontpageediting' value='1'/>"),t.append("<input type='hidden' name='publish' value='1'/>"),e("body").append(t),t.submit()}),e(document).on("click",".preview-section",function(){s.showAllSectionsLoader(),e(this).find("i").toggleClass("fa-eye fa-eye-slash");var t=e(this).find("i").is(".fa-eye-slash");if(e("body").toggleClass("preview",t),e(".settings,.publish,.add-section,.editing-action,.editing-alert").toggleClass("d-flex",!t).toggleClass("d-none",t),e("html, body").animate({scrollTop:0},e(window).scrollTop()/6),e(m+" .fa-eye-slash").parents("section[data-instance]").toggleClass("section-invisible",t),transparentheader)if(t){var o=e("body").find("section[data-instance]:not(.section-invisible)"),i=!1;o&&(i=e(o[0]).is(".section-slider")),e("body").toggleClass("has-slider animate-header",i)}else e("body").toggleClass("has-slider animate-header",e("body").find("section[data-instance]:first-child").is(".section-slider"));setTimeout(function(){s.hideAllSectionsLoader()},2e3)}),e(document).on(l.SECTION_ADDED+" "+l.SECTION_UPDATED,function(e){switch(e.configdata.sectionname){case"courses":var t=s.getSectionElement(e.configdata.id);if(t.is(".categoryandcourses-view")&&0!=e.configdata.categorylist.length){var o=e.configdata.categorylist[0].categoryid;v(e.configdata.id,o)}else p(t.data("instance"),{})}}),e("body").on("click",".home-sections .section-courses .category-list .category-item",function(){var t=e(this).parents("section[data-instance]").data("instance");e(this).parents("section[data-instance]").find(".courses-slider").removeClass("show"),v(t,e(this).data("id"),function(){e(this).siblings().removeClass("active"),e(this).addClass("active"),e(this).parents(".category-list").removeClass("show")}.bind(this))}),e("body").on("click",".home-sections .section-courses .category-list .site-skintools-toggle",function(){e(this).parents(".category-list").toggleClass("show")}).on("afterChange",'[data-sectionname="courses"].section-courses:not(.categories-view) .courses-slider',function(t,i,n){if(e(i.$nextArrow).is(".slick-disabled")){var a=e(this).closest('section[data-sectionname="courses"]'),l=e(a).is(".categoryandcourses-view")?e(a).find(".category-list .category-item.active").data("id"):0,d=a.data("instance"),u=a.data("totalcourses"),g=a.data("current");g+25<u&&r.call([{methodname:"local_remuihomepage_get_frontpage_section_courses_in_category",args:{instanceid:d,categoryid:l,start:g+25}}])[0].done(function(t){var n=0;s.showSectionLoader(d,!0),t=JSON.parse(t),a.data("current",g+25),t.courses.forEach(function(a){a.sectionproperties=t.sectionproperties,a.shadowless=t.sectionproperties.shadowless,o.render("theme_remui/course_card_grid",a).done(function(o,a){o="<div><div>"+o+"</div></div>",e(i.$slider).slick("slickAdd",o),++n==t.courses.length&&s.showSectionLoader(d,!1)}).fail(c.exception)})}).fail(c.exception)}}).on("afterChange",'[data-sectionname="courses"].section-courses.categories-view .courses-slider',function(t,i,n){if(e(i.$nextArrow).is(".slick-disabled")){var a=e(this).closest('section[data-sectionname="courses"]'),r=a.data("instance"),l=a.find(".category-wrapper").data("categories"),d=a.find(".category-wrapper").data("categories-loaded");d<l&&(s.showSectionLoader(r,!0),f(r,d+1,20,function(t){var n=0;t=JSON.parse(t),a.find(".category-wrapper").data("categories-loaded",d+t.categorylist.length),t.categorylist.forEach(function(a){a.sectionproperties=t.sectionproperties,a.shadowless=t.sectionproperties.shadowless,o.render("local_remuihomepage/category_container",a).done(function(o,a){o="<div><div>"+o+"</div></div>",e(i.$slider).slick("slickAdd",o),++n==t.categorylist.length&&s.showSectionLoader(r,!1)}).fail(function(e){c.exception(e),s.showSectionLoader(r,!1)})})},function(e){c.exception(e),s.showSectionLoader(r,!1)}))}}).on("card-list-scroll",function(t,i){var n=e('[data-instance="'+i+'"][data-sectionname="courses"].categoryandcourses-view'),a=n.find(".card-list");if(e(a).scrollTop()+e(a).innerHeight()>=e(a)[0].scrollHeight){i=n.data("instance");var r=n.find(".course-category-wrapper").data("categories"),l=n.find(".course-category-wrapper").data("categories-loaded");l<r&&(s.showSectionLoader(i,!0),f(i,l+1,50,function(t){(t=JSON.parse(t)).shadowless=t.sectionproperties.shadowless,n.find(".course-category-wrapper").data("categories-loaded",l+t.categorylist.length),o.render("local_remuihomepage/course_categories",t).done(function(t,n){o.appendNodeContents(e(a),t,n),s.showSectionLoader(i,!1)}).fail(function(e){c.exception(e),s.showSectionLoader(i,!1)})},function(e){c.exception(e),s.showSectionLoader(i,!1)}))}})};return{init:function(t,o){d=t,o&&w(),e(document).ready(function(){S(),s.LoadAllSections()})}}});
//# sourceMappingURL=frontpage.min.js.map
