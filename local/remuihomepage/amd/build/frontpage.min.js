define(["jquery","core/modal_factory","core/templates","core/str","core/modal_events","local_remuihomepage/sectionmanager","core/fragment","core/ajax","core/notification","theme_remui/events"],function(e,t,i,o,n,a,s,r,c,l){var d=-1,u=null,g=null,m=".home-sections button.section-visibility",h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e};function f(e,t,i,o,n){r.call([{methodname:"local_remuihomepage_get_frontpage_categories",args:{instanceid:e,offset:t,limit:i}}])[0].done(o).fail(n)}function p(t,i){var o={dots:!1,arrows:!0,infinite:!1,speed:500,prevArrow:e("section[data-instance='"+t+"'] .button-container .btn-prev"),nextArrow:e("section[data-instance='"+t+"'] .button-container .btn-next"),rtl:"rtl"==e("html").attr("dir"),slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:800,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]};null!=i&&"object"==typeof i&&h(o,i);var n=a.getSectionElement(t);n.find(".available-courses").addClass("d-none"),0==n.find(".courses-slider .empty-courses-container").length&&(n.find(".courses-slider").slick(o).on("setPosition",function(t,i){e(n).find(".slick-slide > div").css("height","100%"),i.$slides.css("height",i.$slideTrack.height()+"px")}),n.find(".available-courses").removeClass("d-none"))}function v(e,t,o){a.showSectionLoader(e,!0);var n=a.getSectionElement(e);n.find(".courses-slider").removeClass("show"),r.call([{methodname:"local_remuihomepage_get_frontpage_section_courses_in_category",args:{instanceid:e,categoryid:t},done:function(t){(t=JSON.parse(t)).shadowless=t.sectionproperties.shadowless,t.shadowcolor=t.sectionproperties.shadowcolor,n.find(".courses-slider.slick-initialized.slick-slider").slick("unslick"),n.find(".courses-slider").empty(),n.data("totalcourses",t.totalcourse),n.data("current",0),i.render("local_remuihomepage/courses_cards",t).done(function(t,a){i.appendNodeContents(n.find(".courses-slider"),t,a),p(e,{slidesToShow:3,slidesToScroll:3}),"function"==typeof o&&o()}).fail(c.exception),a.showSectionLoader(e,!1)},fail:function(t){a.showSectionLoader(e,!1),c.exception(t)}}])}var _=function(t){var i=e(t).attr("id").replace("id_block_","").replace("_style",""),o="#id_block_"+i+"_htmleditable ",n=e(t).val().replace(/(([\.\#]?[\w\d\_\-]+\s*)+\{)/,function(e){return o+e});e(t).next().is("#block-"+i+"-style")||e(t).after('<style id="block-'+i+'-style" type="text/css"></style>'),e(t).next().html(n)};function y(t){return e(t).attr("data-instance")}var b=function(t,i){var o={instanceid:t};null!=i&&(o.formdata=i);var n=s.loadFragment("local_remuihomepage","frontpage_section_form",d,o);return n.done(function(t,i){setTimeout(function(){var t=e("body").find("form .block-style textarea");0!=t.length&&t.each(function(t,i){_(e(i))})},2e3)}),n},w=function(){!function(o){var n=e(".add-section");t.create({large:!0,body:i.render("local_remuihomepage/sections_list",o)},n).then(function(e){u=e,e.setTitle(M.util.get_string("addsection","local_remuihomepage")),e.modal.addClass("modal-sidebar d-inline-flex"),e.modal.width("500px")}.bind(this)).fail(c.exception)}({sections:[{section:"slider",title:M.util.get_string("slidersection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/slider","local_remuihomepage")},{section:"aboutus",title:M.util.get_string("aboutussection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/aboutus","local_remuihomepage")},{section:"contact",title:M.util.get_string("contactsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/contact","local_remuihomepage")},{section:"feature",title:M.util.get_string("featuresection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/feature","local_remuihomepage")},{section:"courses",title:M.util.get_string("coursessection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/courses","local_remuihomepage")},{section:"team",title:M.util.get_string("teamsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/team","local_remuihomepage")},{section:"testimonial",title:M.util.get_string("testimonialsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/testimonial","local_remuihomepage")},{section:"html",title:M.util.get_string("htmlsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/html","local_remuihomepage")},{section:"separator",title:M.util.get_string("separatorsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/separator","local_remuihomepage")}]})},S=function(){e(window).scroll(function(){if(e(".pagelayout-frontpage section.lazy-section").each(function(t){var i=e(this).position().top;if(e(window).scrollTop()+e(window).height()+2*e(window).height()>i&&e(this).is(".lazy-section")){e(this).removeClass("lazy-section");var o=e(this).data("instance"),n=a.getLoadedSection(o);a.reloadSection({success:!0,context:n},function(){e('.home-sections section[data-instance="'+o+'"]')})}else;}),e(".pagelayout-frontpage section.invisible").each(function(t){var i=e(this).position().top+100;e(window).scrollTop()+e(window).height()>i&&setTimeout(function(){e(this).removeClass("invisible"),1==appearanimation&&("animation-slide-left-right"==appearanimationstyle?e(this).prev().is(".animation-slide-left")?e(this).addClass("animation-slide-right"):e(this).addClass("animation-slide-left"):e(this).addClass(appearanimationstyle))}.bind(this),100)}),transparentheader){if(e("section[data-instance]:first-child").is(".section-slider"))if(e(window).scrollTop()<45)return void e("body.has-slider").addClass("animate-header");e("body.has-slider").removeClass("animate-header")}}),e("body").on("input",".separator-style select, .separator-style input",function(){!function(t){var i=e(t).find("#id_style").val(),o=e(t).find('[name="color"]').val(),n=e(t).find('[name="color2"]').val(),a=e(t).find("#id_height").val(),s={margin:"0px auto",width:e(t).find("#id_width").val()+"%"};switch(e(t).find('[name="color2"]').parents(".separator-style").toggleClass("d-none","gradient"!=i),i){case"blur":s.height="0px",s["background-image"]="none",s.border="1px solid "+o,s["box-shadow"]="0 0 "+a+"px "+a/2+"px "+o;break;case"blurend":s.background="none",s["box-shadow"]="none",s.border="none",s.height=a+"px",s["background-image"]="linear-gradient(to right, #ffffff, "+o+", #ffffff)";break;case"gradient":s["box-shadow"]="none",s["background-image"]="none",s.border="none",s.height=a+"px",s.background="linear-gradient(to right, "+o+" 0%, "+n+" 50%, "+o+" 100%)";break;default:s["box-shadow"]="none",s["background-image"]="none",s.height="0px",s["border-top"]=a+"px "+i+" "+o}e(t).find("#remui_separator_output").css(s)}(e(this).closest("form"))}),e("body").on("change",".updateform select",function(){var t=e(this).parents("form").find('[name="instanceid"]').val(),i=JSON.stringify(g.getRoot().find("form").serialize()),o=b(t,i);g.setBody(o)}),e(document).on("click",".home-sections button.edit-section",function(){var i=y(this),o=e(this).attr("data-sectionname");t.create({type:t.types.SAVE_CANCEL,title:"Edit "+o.charAt(0).toUpperCase()+o.slice(1)+" Section",body:b(i,null)}).then(function(t){g=t,t.modal.addClass("modal-sidebar d-inline-flex editmodal");var o=t.getRoot();o.on(n.save,function(e){e.preventDefault();var t=o.find("form");if("undefined"==typeof remui_section_form_validate||remui_section_form_validate(t)){var n=JSON.stringify(t.serialize());a.updateSection(i,n),g.hide()}}),o.on(n.hidden,function(){g.destroy(),e(document).find(".mform.atto_form.atto_media").parents(".moodle-dialogue-base").remove()}),t.show()})}),e(document).on("click",".home-sections button.delete-section",function(){var e=y(this);t.create({type:t.types.SAVE_CANCEL,title:"Delete item",body:"Do you really want to delete?"}).then(function(t){t.setSaveButtonText("Delete");var i=t.getRoot();i.on(n.save,function(){a.deleteInstance(e,!0)}),i.on(n.hidden,function(){t.destroy()}),t.show()})}),e(document).on("click",".home-sections button.cancel-delete-section",function(){var e=y(this);a.deleteInstance(e,!1)}),e(document).on("click",".home-sections button.confirm-delete-section",function(){var e=y(this);a.deleteInstance(e,2)}),e("body").on("input",".block-style textarea",function(){_(e(this))}),e(document).on("click",".settings",function(){t.create({type:t.types.SAVE_CANCEL,title:M.util.get_string("homepagesettings","local_remuihomepage"),body:s.loadFragment("local_remuihomepage","frontpage_settings_form",d)},e("#create")).done(function(e){e.modal.addClass("modal-sidebar d-inline-flex editmodal"),e.show(),e.getRoot().on(n.save,function(t){t.preventDefault();var i=e.getRoot().find("form"),o=JSON.stringify(i.serialize());r.call([{methodname:"local_remuihomepage_save_frontpage_settings",args:{settings:o}}])[0].done(function(e){window.location.reload()}).fail(c.exception),e.hide()}),e.getRoot().on(n.hidden,function(){e.destroy()})})}),e(document).on("click",".sections-container div[class*='section-']",function(){var t=e(this).data("section");u.hide(),a.setSectionName(t),a.addSection()}),e("body").on("click",".moveup-section",function(){a.reorderSection(e(this).data("instance"),-1,!0)}).on("click",".movedown-section",function(){a.reorderSection(e(this).data("instance"),1,!0)}),e("body").on("click",m,function(){var t=e(this).data("instance"),i=e(this).data("visible");a.updateVisibility(t,!i)}),e(document).on("slid.bs.carousel",".home-sections section .carousel",function(){var t=e(this).parent().data("instance");a.playSliderVideo(t)}),e(document).on("click",".editing-action",function(){var t=e('<form method="post"></form>');t.append("<input type='hidden' name='frontpageediting' value='1'/>"),t.append("<input type='hidden' name='editpage' value='"+e(this).data("edit")+"'/>"),e("body").append(t),t.submit()}),e(document).on("click",".publish",function(){var t=e('<form method="post"></form>');t.append("<input type='hidden' name='frontpageediting' value='1'/>"),t.append("<input type='hidden' name='publish' value='1'/>"),e("body").append(t),t.submit()}),e(document).on("click",".preview-section",function(){a.showAllSectionsLoader(),e(this).find("i").toggleClass("fa-eye fa-eye-slash");var t=e(this).find("i").is(".fa-eye-slash");if(e("body").toggleClass("preview",t),e(".settings,.publish,.add-section,.editing-action,.editing-alert").toggleClass("d-flex",!t).toggleClass("d-none",t),e("html, body").animate({scrollTop:0},e(window).scrollTop()/6),e(m+" .fa-eye-slash").parents("section[data-instance]").toggleClass("section-invisible",t),transparentheader)if(t){var i=e("body").find("section[data-instance]:not(.section-invisible)"),o=!1;i&&(o=e(i[0]).is(".section-slider")),e("body").toggleClass("has-slider animate-header",o)}else e("body").toggleClass("has-slider animate-header",e("body").find("section[data-instance]:first-child").is(".section-slider"));setTimeout(function(){a.hideAllSectionsLoader()},2e3)}),e(document).on(l.SECTION_ADDED+" "+l.SECTION_UPDATED,function(e){switch(e.configdata.sectionname){case"courses":var t=a.getSectionElement(e.configdata.id);if(t.is(".categoryandcourses-view")&&0!=e.configdata.categorylist.length){var i=e.configdata.categorylist[0].categoryid;v(e.configdata.id,i)}else p(t.data("instance"),{})}}),e("body").on("click",".home-sections .section-courses .category-list .category-item",function(){var t=e(this).parents("section[data-instance]").data("instance");e(this).parents("section[data-instance]").find(".courses-slider").removeClass("show"),v(t,e(this).data("id"),function(){e(this).siblings().removeClass("active"),e(this).addClass("active"),e(this).parents(".category-list").removeClass("show")}.bind(this))}),e("body").on("click",".home-sections .section-courses .category-list .site-skintools-toggle",function(){e(this).parents(".category-list").toggleClass("show")}).on("afterChange",'[data-sectionname="courses"].section-courses:not(.categories-view) .courses-slider',function(t,o,n){if(e(o.$nextArrow).is(".slick-disabled")){var s=e(this).closest('section[data-sectionname="courses"]'),l=e(s).is(".categoryandcourses-view")?e(s).find(".category-list .category-item.active").data("id"):0,d=s.data("instance"),u=s.data("totalcourses"),g=s.data("current");g+25<u&&r.call([{methodname:"local_remuihomepage_get_frontpage_section_courses_in_category",args:{instanceid:d,categoryid:l,start:g+25}}])[0].done(function(t){var n=0;a.showSectionLoader(d,!0),t=JSON.parse(t),s.data("current",g+25),t.courses.forEach(function(s){s.sectionproperties=t.sectionproperties,s.shadowless=t.sectionproperties.shadowless,i.render("theme_remui/course_card_grid",s).done(function(i,s){i="<div><div>"+i+"</div></div>",e(o.$slider).slick("slickAdd",i),++n==t.courses.length&&a.showSectionLoader(d,!1)}).fail(c.exception)})}).fail(c.exception)}}).on("afterChange",'[data-sectionname="courses"].section-courses.categories-view .courses-slider',function(t,o,n){if(e(o.$nextArrow).is(".slick-disabled")){var s=e(this).closest('section[data-sectionname="courses"]'),r=s.data("instance"),l=s.find(".category-wrapper").data("categories"),d=s.find(".category-wrapper").data("categories-loaded");d<l&&(a.showSectionLoader(r,!0),f(r,d+1,20,function(t){var n=0;t=JSON.parse(t),s.find(".category-wrapper").data("categories-loaded",d+t.categorylist.length),t.categorylist.forEach(function(s){s.sectionproperties=t.sectionproperties,s.shadowless=t.sectionproperties.shadowless,i.render("local_remuihomepage/category_container",s).done(function(i,s){i="<div><div>"+i+"</div></div>",e(o.$slider).slick("slickAdd",i),++n==t.categorylist.length&&a.showSectionLoader(r,!1)}).fail(function(e){c.exception(e),a.showSectionLoader(r,!1)})})},function(e){c.exception(e),a.showSectionLoader(r,!1)}))}}).on("card-list-scroll",function(t,o){var n=e('[data-instance="'+o+'"][data-sectionname="courses"].categoryandcourses-view'),s=n.find(".card-list");if(e(s).scrollTop()+e(s).innerHeight()>=e(s)[0].scrollHeight){o=n.data("instance");var r=n.find(".course-category-wrapper").data("categories"),l=n.find(".course-category-wrapper").data("categories-loaded");l<r&&(a.showSectionLoader(o,!0),f(o,l+1,50,function(t){(t=JSON.parse(t)).shadowless=t.sectionproperties.shadowless,n.find(".course-category-wrapper").data("categories-loaded",l+t.categorylist.length),i.render("local_remuihomepage/course_categories",t).done(function(t,n){i.appendNodeContents(e(s),t,n),a.showSectionLoader(o,!1)}).fail(function(e){c.exception(e),a.showSectionLoader(o,!1)})},function(e){c.exception(e),a.showSectionLoader(o,!1)}))}})};return{init:function(t,i){d=t,i&&w(),e(document).ready(function(){S(),a.LoadAllSections()})}}});
//# sourceMappingURL=frontpage.min.js.map
